<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="Keywords" content="">
    <meta name="full-screen" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="#006cb4">
    <meta name="apple-mobile-web-app-title" content="TOM&#39;s zone">
    <meta name="description" content="TOM&#39;s zone">
    <link rel="dns-prefetch" href="https://hasaki.xyz">
    <link rel="preconnect" href="https://hasaki.xyz">
    <link rel="manifest" href="/sw/manifest.json"/>
<title>React æ¨¡å¼ï¼ŒæŠ€å·§ï¼ŒæŠ€å·§å’Œçªé—¨ - TOM&#39;s zone</title>

<meta name="description" content="è¿™ç¯‡æ–‡ç« æ•´ç†äº†å­¦ä¹  React è¿‡ç¨‹ä¸­ä»¥åŠå®é™…å¼€å‘åº”ç”¨å½“ä¸­ä¸€äº›æ¨¡å¼ï¼ŒæŠ€å·§ï¼ŒæŠ€å·§å’Œçªé—¨ã€‚
å¤§éƒ¨é—¨å†…å®¹æ˜¯åŸºäº React æ¡†æ¶ä¸‹é¢äº§ç”Ÿçš„ä¸€äº›å†…å®¹ï¼Œæœ‰å¾ˆå¤§çš„å±€é™æ€§ï¼Œä½†æ˜¯ç¡®å®å¸¦æ¥äº†æ–°çš„ç†å¿µå’Œå¼€å‘æ–¹å¼ï¼Œä»è€…è§ä»æ™ºè€…è§æ™ºï¼Œå¤šå­¦ä¹ ä¸€ç‚¹å†…å®¹æ€»å½’å¯¹èŒä¸šç”Ÿæ¶¯æœ‰å¥½å¤„ã€‚
 æœ¬ç¯‡æ–‡ç« è¿˜åœ¨æŒç»­æ›´æ–°ä¸­ï¼Œå¦‚æœæœ‰é”™è¯¯çƒ¦è¯·æŒ‡æ­£ã€‚
 Normally React ä¸€äº›å¸¸è§çš„å…³äº React éœ€è¦äº†è§£çš„å†…å®¹ï¼Œå°±ç®€å•åˆ—ä¸¾å¦‚ä¸‹ã€‚ä¸‹é¢åªä¼šåˆ—åˆ°æœ¬äººè®¤ä¸ºæ¯”è¾ƒå€¼å¾—é‡è§†çš„éƒ¨åˆ†è¿›è¡Œè¯¦ç»†é™ˆè¿°ã€‚
 è¯­æ³•å±‚é¢â€”â€”åŸºç¡€å…¥é—¨
  JSX è¯­æ³•ã€React åŸºæœ¬å†…å®¹ç­‰ Derocator æˆ–è€… async await ç­‰å¸¸è§ ES6ã€ES7 çš„å†…å®¹ React Lists and Keys   å¸¸ç”¨å±‚é¢â€”â€”æ—¥å¸¸å¼€å‘å¿…å¤‡
  smart component and dumb component container component and presentation component stateless component Events handler bind thisï¼šbind this æˆ–è€… Derocator æˆ–è€… proposal-class-public-fields-declarations Conditionals render in JSX æˆ–è€… IIFE render in JSX æˆ–è€… methods render in JSX Dynamic router ä»¥åŠ Dynamic componentï¼Œç”šè‡³äº Dynamic redux injection HOC Render props 16.">




    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Lato|Raleway">


    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/ocean.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/javascript.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/python.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/go.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/css.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/swift.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/objectivec.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/rust.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/yaml.min.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/languages/bash.min.js"></script>


    <link rel="stylesheet" href="/css/bundle.min.css"/>
<script src="/js/bundle.js"></script>

<style>
	a { color: #ff8181; }
	blockquote {
		background: rgba(255, 129, 129, .1);
		border-left-color: #ff8181;
		border-right-color: #ff8181; }
	.bar a:hover {
		color: #ff8181;
		text-decoration: none; }
	.sep {
		margin-top: 2rem;
		margin-bottom: 1rem;
		margin-left:0;
		width: 24rem;
		border-top: 2px solid #ff8181; }
    .bar li.active a{
        color:#ff8181;
    }
</style>

</head>

<body>
<header class="container no-print">
	<div class="u-header">
		<nav class="bar">
	<ul><li>
			<a href="/">
				<img class="icon-text" src="/img/prev.svg"/>
			</a>
		</li>
		
		<li class="active"><a href="/blog/">Blog</a></li>
		<li class=""><a href="/gallery/">Gallery</a></li>
		<li class=""><a href="/life/">Life</a></li></ul>
</nav>

	</div>
</header>
<main class="container">

<article>
    <header><hgroup id="brand">
  <h1>React æ¨¡å¼ï¼ŒæŠ€å·§ï¼ŒæŠ€å·§å’Œçªé—¨</h1>
  <h5>
    
    <time datetime="2017-11-02 15:29:40 &#43;0800 CST">Nov 02, 2017</time>
    <span class="no-print">
      -
      
      <a href="/tags/react">React</a>
      
      <a href="/tags/frontend">FrontEnd</a>
      </span>
  </h5>

  <a
    style="margin-top: 1.2rem;display: inline-block;"
    href="https://github.com/V-Tom/blog/blob/hugo/content/blog/2017-11-02-React%20%e6%a8%a1%e5%bc%8f%ef%bc%8c%e6%8a%80%e5%b7%a7%ef%bc%8c%e6%8a%80%e5%b7%a7%e5%92%8c%e7%aa%8d%e9%97%a8/index.md"
    >âœ¨âœ¨âœ¨You can Edit this Article on Github site</a
  >

  <div id="git-update-time">
  âœï¸âœï¸âœï¸ This article .MD file was last updated at:
  <b>Loading ...</b>
</div>

<script data-name="commits">
  ;(async () => {
    const b = document.querySelector('#git-update-time').querySelector('b')

    if (window.location.href.includes('localhost')) {
      b.innerHTML = 'localhost disable'
      return
    }

    const commits = await fetch(
      'https://api.github.com/repos/V-Tom/blog/commits?sha=hugo&path=content/blog\/2017-11-02-React æ¨¡å¼ï¼ŒæŠ€å·§ï¼ŒæŠ€å·§å’Œçªé—¨\/index.md',
    ).then(res => res.json())
    try {
      const time = new Date(commits[0].commit.committer.date)
      b.innerHTML = `${time.getFullYear()}-${time.getMonth() +
        1}-${time.getDate()}`
    } catch (e) {
      b.innerHTML = 'unknown'
    }
  })()
</script>


  
</hgroup>
<hr class="sep" />
</header>
    <section id="markdown">
        

<p>è¿™ç¯‡æ–‡ç« æ•´ç†äº†å­¦ä¹  <code>React</code> è¿‡ç¨‹ä¸­ä»¥åŠå®é™…å¼€å‘åº”ç”¨å½“ä¸­ä¸€äº›æ¨¡å¼ï¼ŒæŠ€å·§ï¼ŒæŠ€å·§å’Œçªé—¨ã€‚</p>

<p>å¤§éƒ¨é—¨å†…å®¹æ˜¯åŸºäº <code>React</code> æ¡†æ¶ä¸‹é¢äº§ç”Ÿçš„ä¸€äº›å†…å®¹ï¼Œæœ‰å¾ˆå¤§çš„å±€é™æ€§ï¼Œä½†æ˜¯ç¡®å®å¸¦æ¥äº†æ–°çš„ç†å¿µå’Œå¼€å‘æ–¹å¼ï¼Œä»è€…è§ä»æ™ºè€…è§æ™ºï¼Œå¤šå­¦ä¹ ä¸€ç‚¹å†…å®¹æ€»å½’å¯¹èŒä¸šç”Ÿæ¶¯æœ‰å¥½å¤„ã€‚</p>

<blockquote>
<p>æœ¬ç¯‡æ–‡ç« è¿˜åœ¨æŒç»­æ›´æ–°ä¸­ï¼Œå¦‚æœæœ‰é”™è¯¯çƒ¦è¯·æŒ‡æ­£ã€‚</p>
</blockquote>

<h3 id="normally-react">Normally React</h3>

<p>ä¸€äº›å¸¸è§çš„å…³äº React éœ€è¦äº†è§£çš„å†…å®¹ï¼Œå°±ç®€å•åˆ—ä¸¾å¦‚ä¸‹ã€‚ä¸‹é¢åªä¼šåˆ—åˆ°æœ¬äººè®¤ä¸ºæ¯”è¾ƒå€¼å¾—é‡è§†çš„éƒ¨åˆ†è¿›è¡Œè¯¦ç»†é™ˆè¿°ã€‚</p>

<blockquote>
<p>è¯­æ³•å±‚é¢â€”â€”åŸºç¡€å…¥é—¨</p>
</blockquote>

<ul>
<li>JSX è¯­æ³•ã€React åŸºæœ¬å†…å®¹ç­‰</li>
<li>Derocator æˆ–è€… async await ç­‰å¸¸è§ ES6ã€ES7 çš„å†…å®¹</li>
<li>React Lists and Keys</li>
</ul>

<blockquote>
<p>å¸¸ç”¨å±‚é¢â€”â€”æ—¥å¸¸å¼€å‘å¿…å¤‡</p>
</blockquote>

<ul>
<li><code>smart component and dumb component</code></li>
<li><code>container component and presentation component</code></li>
<li><code>stateless component</code></li>
<li>Events handler bind thisï¼šbind this æˆ–è€… Derocator æˆ–è€… <a href="https://github.com/tc39/proposal-class-fields">proposal-class-public-fields-declarations</a></li>
<li><code>Conditionals render in JSX</code> æˆ–è€… <code>IIFE render in JSX</code> æˆ–è€… <code>methods render in JSX</code></li>
<li><code>Dynamic router</code> ä»¥åŠ <code>Dynamic component</code>ï¼Œç”šè‡³äº <code>Dynamic redux injection</code></li>
<li><code>HOC</code></li>
<li><a href="https://reactjs.org/docs/render-props.html">Render props</a></li>
<li><a href="https://reactjs.org/docs/code-splitting.html">16.6 ç‰ˆæœ¬ä¸­æ·»åŠ  Lazy, Suspense, memo</a></li>
<li><a href="https://reactjs.org/docs/hooks-intro.html">17 ç‰ˆæœ¬ä¸­æ·»åŠ  hooks</a></li>
</ul>

<blockquote>
<p>è¿›é˜¶å±‚é¢â€”â€”æ€§èƒ½ä¼˜åŒ–å’Œä¸šåŠ¡è§£è€¦å¿…å¤‡</p>
</blockquote>

<ul>
<li><code>PureRenderMixin</code> ä»¥åŠ <code>Pure Component</code> ä»¥åŠ <code>shouldComponentUpdate check</code></li>
<li><code>unstable_rendersubtreeintocontainer</code> ä»¥åŠ portal</li>
<li>React <code>fiber</code> æ›´æ–°æœºåˆ¶</li>
<li><code>React call return</code></li>
</ul>

<p>è™šæ‹Ÿ DOM</p>

<ul>
<li><a href="https://github.com/livoras/blog/issues/13">æ·±åº¦å‰–æï¼šå¦‚ä½•å®ç°ä¸€ä¸ª Virtual DOM ç®—æ³•</a></li>
</ul>

<blockquote>
<p>ä¸€äº›å‘¨è¾¹æ‹“å±•ï¼ˆå«æœ‰æœ¬äººè§‚å¿µ</p>
</blockquote>

<ul>
<li>styled components</li>
<li>Redux saga</li>
<li>Recompose</li>
</ul>

<blockquote>
<p>æœ€åå¼ºçƒˆå»ºè®®æ¨èè¿™ä¸ªï¼š<a href="https://github.com/semlinker/reactjs-interview-questions">List of top 301 ReactJS Interview Questions &amp; Answers</a></p>
</blockquote>

<h3 id="pure-render-checks">Pure Render Checks</h3>

<pre><code class="language-Jsx">// åçš„ä¾‹å­
class Table extends PureComponent {

  update(e) {
    this.props.update(e.target.value);
  }

  render() {
    return (
      &lt;div&gt;
        {this.props.items.map(i =&gt;
          &lt;Cell
            data={i}
            options={this.props.options || []}
            onChange={this.update.bind(this)}
            onClick={e =&gt; this.props.update(e.target.value)}/&gt;;
           /&gt;
        )}
      &lt;/div&gt;
    );
  }
}

</code></pre>

<p>è¿™ç§å†™æ³•çš„é—®é¢˜åœ¨äº<code>{this.props.options || []}</code> è¿™ç§å†™æ³•ä¼šå¯¼è‡´æ‰€æœ‰çš„ Cell éƒ½è¢«é‡æ–°æ¸²æŸ“å³ä½¿åªæœ‰ä¸€ä¸ª cell å‘ç”Ÿæ”¹å˜ã€‚</p>

<p>åŸå› æ˜¯ï¼šæ¯æ¬¡ä¼ å…¥çš„<code>[]</code>éƒ½ç›¸å½“äºåˆ›å»ºäº†æ–°çš„ Array å®ä¾‹ã€‚åœ¨ JavaScript é‡Œé¢ï¼Œä¸åŒçš„å®ä¾‹æ˜¯æœ‰ä¸åŒçš„å®ä½“çš„ï¼Œæ‰€ä»¥æµ…æ¯”è¾ƒåœ¨è¿™ç§æƒ…å†µä¸‹æ€»æ˜¯ä¼šè¿”å› falseï¼Œç„¶åç»„ä»¶å°±ä¼šè¢«é‡æ–°æ¸²æŸ“ã€‚</p>

<p>å¯¹äº<code>onChange</code>ï¼Œ<code>onClick</code>ä¹Ÿæ˜¯ä¸€æ ·çš„é—®é¢˜ï¼Œä¹Ÿä¼šå¯¼è‡´é‡æ–°æ¸²æŸ“ã€‚</p>

<pre><code class="language-jsx">// å¥½çš„ä¾‹å­
const defaultval = [] // &lt;---  ä¹Ÿå¯ä»¥ä½¿ç”¨defaultProps
class Table extends PureComponent {
  update(e) {
    this.props.update(e.target.value)
  }

  render() {
    return (
      &lt;div&gt;
        {this.props.items.map(i =&gt; (
          &lt;Cell
            data={i}
            options={this.props.options || defaultval}
            onChange={this.update}
            onClick={this.update}
          /&gt;
        ))}
      &lt;/div&gt;
    )
  }
}
</code></pre>

<p>æ€»ç»“å°±æ˜¯ï¼š <strong>props ä¸Šçš„ä»»ä½• prop å€¼å°½é‡åªåˆ›å»ºä¸€æ¬¡, åªç»‘å®šä¸€æ¬¡</strong></p>

<p>Reference:</p>

<ul>
<li><a href="https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f">https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f</a></li>
<li><a href="https://github.com/nfour/js-structures/blob/master/guides/react-anti-patterns.md#pure-render-immutability">https://github.com/nfour/js-structures/blob/master/guides/react-anti-patterns.md#pure-render-immutability</a></li>
<li><a href="https://flexport.engineering/optimizing-react-rendering-part-1-9634469dca02">Optimizing React Rendering</a></li>
</ul>

<h3 id="synthetic-events-in-react">Synthetic events in React</h3>

<p>React åœ¨å¤„ç†äº‹ä»¶(event æ—¶), äº‹å®ä¸Šä½¿ç”¨äº† <code>SyntheticEvent</code> å¯¹è±¡åŒ…è£¹äº†åŸç”Ÿçš„ event å¯¹è±¡.</p>

<p>è¿™äº› React è‡ªå·±ç»´æŠ¤çš„å¯¹è±¡æ˜¯ç›¸äº’è”ç³»çš„, æ„å‘³ç€å¦‚æœå¯¹äºæŸä¸€ä¸ªäº‹ä»¶, æˆ‘ä»¬ç»™å‡ºäº†å¯¹åº”çš„å“åº”å‡½æ•°(handler), å…¶ä»–çš„ <code>SyntheticEvent</code> å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥é‡ç”¨çš„.è¿™ä¹Ÿæ˜¯ React æå‡æ€§èƒ½çš„ç§˜è¯€ä¹‹ä¸€. ä½†æ˜¯è¿™ä¹Ÿæ„å‘³ç€, å¦‚æœæƒ³è¦é€šè¿‡å¼‚æ­¥çš„æ–¹å¼è®¿é—®äº‹ä»¶å¯¹è±¡æ˜¯ä¸å¯èƒ½çš„, å› ä¸ºå‡ºäº reuse çš„åŸå› , äº‹ä»¶å¯¹è±¡é‡Œé¢çš„å€¼éƒ½è¢«é‡ç½®äº†.</p>

<p>ä¸‹é¢è¿™æ®µä»£ç ä¼šåœ¨æ§åˆ¶å°é‡Œé¢æ‰“å‡º null, å› ä¸ºäº‹ä»¶åœ¨ <code>SyntheticEvent</code> æ± ä¸­è¢«é‡ç”¨äº†.</p>

<pre><code class="language-Jsx">function handleClick(event) {
  setTimeout(function () {
    console.log(event.target.name);
  }, 1000);
}
</code></pre>

<p>ä¸ºäº†é¿å…è¿™ç§æƒ…å†µ, ä½ éœ€è¦å»ä¿å­˜ä½ å…³å¿ƒçš„äº‹ä»¶çš„å±æ€§.</p>

<pre><code class="language-Jsx">function handleClick(event) {
  let name = event.target.name;
  setTimeout(function () {
    console.log(name);
  }, 1000);
}
</code></pre>

<p>Reference:</p>

<ul>
<li><a href="https://medium.com/nick-parsons/react-redux-best-practices-gotchas-56cf61c1c415">React/Redux: Best practices &amp; gotchas</a></li>
<li><a href="https://www.youtube.com/watch?v=dRo_egw7tBc">React events in depth w/ Kent C. Dodds, Ben Alpert, &amp; Dan Abramov</a></li>
</ul>

<h3 id="async-nature-of-setstate">async-nature-of-setState</h3>

<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒReact æ¡†æ¶å‡ºäºæ€§èƒ½ä¼˜åŒ–è€ƒè™‘ï¼Œå¯èƒ½ä¼šå°†å¤šæ¬¡ state æ›´æ–°åˆå¹¶æˆä¸€æ¬¡æ›´æ–°ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼ŒsetState å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°ã€‚ ä½†æ˜¯ï¼Œæœ‰ä¸€äº›è¡Œä¸ºä¹Ÿä¼šé˜»æ­¢ React æ¡†æ¶æœ¬èº«å¯¹äºå¤šæ¬¡ state æ›´æ–°çš„åˆå¹¶ï¼Œä»è€Œè®© state çš„æ›´æ–°å˜å¾—åŒæ­¥åŒ–ã€‚ æ¯”å¦‚: eventListeners, Ajax, setTimeout ç­‰ç­‰ã€‚</p>

<h4 id="è¯¦è§£">è¯¦è§£</h4>

<p>å½“ setState() å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæš‚æ€çš„ state ä½œä¸ºè¿‡æ¸¡ stateï¼Œè€Œä¸æ˜¯ç«‹å³ä¿®æ”¹ <code>this.state</code>ã€‚ å¦‚æœåœ¨è°ƒç”¨ setState() å‡½æ•°ä¹‹åå°è¯•å»è®¿é—® this.stateï¼Œä½ å¾—åˆ°çš„å¯èƒ½è¿˜æ˜¯ setState() å‡½æ•°æ‰§è¡Œä¹‹å‰çš„ç»“æœã€‚ åœ¨ä½¿ç”¨ setState() çš„æƒ…å†µä¸‹ï¼Œçœ‹èµ·æ¥åŒæ­¥æ‰§è¡Œçš„ä»£ç å…¶å®æ‰§è¡Œé¡ºåºæ˜¯å¾—ä¸åˆ°ä¿è¯çš„ã€‚åŸå› ä¸Šé¢ä¹Ÿæåˆ°è¿‡ï¼ŒReact å¯èƒ½ä¼šå°†å¤šæ¬¡ state æ›´æ–°åˆå¹¶æˆä¸€æ¬¡æ›´æ–°æ¥ä¼˜åŒ–æ€§èƒ½ã€‚</p>

<p>è¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼Œä½ ä¼šå‘ç°å½“å’Œ <code>addEventListener</code> , <code>setTimeout</code> å‡½æ•°æˆ–è€…å‘å‡º AJAX call çš„æ—¶å€™ï¼Œè°ƒç”¨ setState , state ä¼šå‘ç”Ÿæ”¹å˜ã€‚å¹¶ä¸” render å‡½æ•°ä¼šåœ¨ setState() å‡½æ•°è¢«è§¦å‘ä¹‹åé©¬ä¸Šè¢«è°ƒç”¨ã€‚é‚£ä¹ˆåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿäº‹å®ä¸Šï¼Œç±»ä¼¼ setTimeout() å‡½æ•°æˆ–è€…å‘å‡º ajax call çš„ fetch å‡½æ•°å±äºè°ƒç”¨æµè§ˆå™¨å±‚é¢çš„ APIï¼Œè¿™äº›å‡½æ•°çš„æ‰§è¡Œå¹¶ä¸å­˜åœ¨ä¸ React çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‰€ä»¥ React å¹¶ä¸èƒ½å¤Ÿåƒæ§åˆ¶å…¶ä»–å­˜åœ¨ä¸å…¶ä¸Šä¸‹æ–‡ä¸­çš„å‡½æ•°ä¸€æ ·ï¼Œå°†å¤šæ¬¡ state æ›´æ–°åˆå¹¶æˆä¸€æ¬¡ã€‚</p>

<p>åœ¨ä¸Šé¢è¿™äº›ä¾‹å­ä¸­ï¼ŒReact æ¡†æ¶ä¹‹æ‰€ä»¥åœ¨é€‰æ‹©åœ¨è°ƒç”¨ setState å‡½æ•°ä¹‹åç«‹å³æ›´æ–° state è€Œä¸æ˜¯é‡‡ç”¨æ¡†æ¶é»˜è®¤çš„æ–¹å¼ï¼Œå³åˆå¹¶å¤šæ¬¡ state æ›´æ–°ä¸ºä¸€æ¬¡æ›´æ–°ï¼Œæ˜¯å› ä¸ºè¿™äº›å‡½æ•°è°ƒç”¨(fetch,setTimeout ç­‰æµè§ˆå™¨å±‚é¢çš„ API è°ƒç”¨)å¹¶ä¸å¤„äº React æ¡†æ¶çš„ä¸Šä¸‹æ–‡ä¸­ï¼ŒReact æ²¡æœ‰åŠæ³•å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚React åœ¨æ­¤æ—¶é‡‡ç”¨çš„ç­–ç•¥å°±æ˜¯åŠæ—¶æ›´æ–°ï¼Œç¡®ä¿åœ¨è¿™äº›å‡½æ•°æ‰§è¡Œä¹‹åçš„å…¶ä»–ä»£ç èƒ½æ‹¿åˆ°æ­£ç¡®çš„æ•°æ®ï¼ˆå³æ›´æ–°è¿‡çš„ state)ã€‚</p>

<pre><code class="language-Jsx">class TestComponent extends React.Component {

  constructor(props) {
    super(props);
    this.state = {
      dollars: 10
    }
    this.onMouseLeaveHandler = this.onMouseLeaveHandler.bind(this);
    this.onTimeoutHandler = this.onTimeoutHandler.bind(this);
    this.onAjaxCallback = this.onAjaxCallback.bind(this);
    this.onClickHandler = this.onClickHandler.bind(this);
  }

  componentDidMount() {
    // Add custom event via `addEventListener`
    //
    // The list of supported React events does include `mouseleave`
    // via `onMouseLeave` prop
    //
    // However, we are not adding the event the `React way` - this will have
    // effects on how state mutates
    //
    // Check the list here - https://facebook.github.io/react/docs/events.html
    document.getElementById('testButton').addEventListener('mouseleave', this.onMouseLeaveHandler);

    // Add JS timeout
    //
    // Again,outside React `world` - this will also have effects on how state
    // mutates
    setTimeout(this.onTimeoutHandler, 10000);

    // Make AJAX request
    fetch('https://api.github.com/users')
      .then(this.onAjaxCallback);
  }

  onClickHandler = () =&gt; {
    console.log('State before (_onClickHandler): ' + JSON.stringify(this.state));
    this.setState({
      dollars: this.state.dollars + 10
    });
    console.log('State after (_onClickHandler): ' + JSON.stringify(this.state));
  }

  onMouseLeaveHandler = () =&gt; {
    console.log('State before (mouseleave): ' + JSON.stringify(this.state));
    this.setState({
      dollars: this.state.dollars + 20
    });
    console.log('State after (mouseleave): ' + JSON.stringify(this.state));
  }

  onTimeoutHandler = () =&gt; {
    console.log('State before (timeout): ' + JSON.stringify(this.state));
    this.setState({
      dollars: this.state.dollars + 30
    });
    console.log('State after (timeout): ' + JSON.stringify(this.state));
  }

  onAjaxCallback = (err, res) =&gt; {
    if (err) {
      console.log('Error in AJAX call: ' + JSON.stringify(err));
      return;
    }

    console.log('State before (AJAX call): ' + JSON.stringify(this.state));
    this.setState({
      dollars: this.state.dollars + 40
    });
    console.log('State after (AJAX call): ' + JSON.stringify(this.state));
  }

  render() {
    console.log('State in render: ' + JSON.stringify(this.state));

    return (
       &lt;button
         id=&quot;testButton&quot;
         onClick={this.onClickHandler}&gt;
         'Click me'
      &lt;/button&gt;
    );
  }
}

ReactDOM.render(
  &lt;TestComponent /&gt;,
  document.getElementById('app')
);
</code></pre>

<h4 id="è§£å†³-setstate-å‡½æ•°å¼‚æ­¥çš„åŠæ³•">è§£å†³ setState å‡½æ•°å¼‚æ­¥çš„åŠæ³•?</h4>

<p>æ ¹æ® React å®˜æ–¹æ–‡æ¡£ï¼ŒsetState å‡½æ•°å®é™…ä¸Šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°ç±»å‹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸º setState å‡½æ•°æ‰§è¡Œåçš„å›è°ƒã€‚é€šè¿‡ä¼ å…¥å›è°ƒå‡½æ•°çš„æ–¹å¼ï¼ŒReact å¯ä»¥ä¿è¯ä¼ å…¥çš„å›è°ƒå‡½æ•°ä¸€å®šæ˜¯åœ¨ setState æˆåŠŸæ›´æ–° this.state ä¹‹åå†æ‰§è¡Œ</p>

<pre><code class="language-Jsx">_onClickHandler: function _onClickHandler() {
   console.log('State before (_onClickHandler): ' + JSON.stringify(this.state));
   this.setState({
   dollars: this.state.dollars + 10
   }, () =&gt; {
   console.log('Here state will always be updated to latest version!');
   console.log('State after (_onClickHandler): ' + JSON.stringify(this.state));
   });
}
</code></pre>

<h4 id="æ›´å¤šå…³äº-setstate-çš„å°çŸ¥è¯†">æ›´å¤šå…³äº setState çš„å°çŸ¥è¯†</h4>

<p>å…¶å® setState ä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚åªæ˜¯å› ä¸ºåœ¨ setState çš„å†…éƒ¨å®ç°ä¸­ï¼Œä½¿ç”¨äº† React updater çš„ enqueueState æˆ–è€… enqueueCallback æ–¹æ³•ï¼Œæ‰é€ æˆäº†å¼‚æ­¥ã€‚</p>

<p>ä¸‹é¢è¿™æ®µæ˜¯ React æºç ä¸­ setState çš„å®ç°:</p>

<pre><code class="language-Jsx">ReactComponent.prototype.setState = function(partialState, callback) {
  invariant(
    typeof partialState === 'object' ||
    typeof partialState === 'function' ||
    partialState == null,
    'setState(...): takes an object of state variables to update or a ' +
    'function which returns an object of state variables.'
  );
  this.updater.enqueueSetState(this, partialState);
  if (callback) {
    this.updater.enqueueCallback(this, callback, 'setState');
  }
};
</code></pre>

<p>è€Œ updater çš„è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆå’Œ React åº•å±‚çš„ Virtual Dom (è™šæ‹Ÿ DOM æ ‘)çš„ diff ç®—æ³•æœ‰ç´§å¯†çš„å…³ç³»ï¼Œæ‰€ä»¥çœŸæ­£å†³å®šåŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„å…¶å®æ˜¯ Virtual DOM çš„ diff ç®—æ³•ã€‚</p>

<p><img src="./setState.png" alt="./setState.png" /></p>

<p>å¯¹ç€ä¸Šé¢çš„æµç¨‹å›¾å¯ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹ï¼š</p>

<ul>
<li>å°† setState ä¼ å…¥çš„ partialState å‚æ•°å­˜å‚¨åœ¨å½“å‰ç»„ä»¶å®ä¾‹çš„ state æš‚å­˜é˜Ÿåˆ—ä¸­</li>
<li>åˆ¤æ–­å½“å‰ React æ˜¯å¦å¤„äºæ‰¹é‡æ›´æ–°çŠ¶æ€ï¼Œå¦‚æœæ˜¯ï¼Œå°†å½“å‰ç»„ä»¶åŠ å…¥å¾…æ›´æ–°çš„ç»„ä»¶é˜Ÿåˆ—ä¸­</li>
<li>å¦‚æœæœªå¤„äºæ‰¹é‡æ›´æ–°çŠ¶æ€ï¼Œå°†æ‰¹é‡æ›´æ–°çŠ¶æ€æ ‡è¯†è®¾ç½®ä¸º trueï¼Œç”¨äº‹åŠ¡å†æ¬¡è°ƒç”¨å‰ä¸€æ­¥æ–¹æ³•ï¼Œä¿è¯å½“å‰ç»„ä»¶åŠ å…¥åˆ°äº†å¾…æ›´æ–°ç»„ä»¶é˜Ÿåˆ—ä¸­</li>
<li>è°ƒç”¨äº‹åŠ¡çš„ <code>waper</code> æ–¹æ³•ï¼Œéå†å¾…æ›´æ–°ç»„ä»¶é˜Ÿåˆ—ä¾æ¬¡æ‰§è¡Œæ›´æ–°ã€‚</li>
<li>æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ <code>componentWillReceiveProps</code></li>
<li>å°†ç»„ä»¶çš„ state æš‚å­˜é˜Ÿåˆ—ä¸­çš„ state è¿›è¡Œåˆå¹¶ï¼Œè·å¾—æœ€ç»ˆè¦æ›´æ–°çš„ state å¯¹è±¡ï¼Œå¹¶å°†é˜Ÿåˆ—ç½®ä¸ºç©º</li>
<li>æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ <code>componentShouldUpdate</code>ï¼Œæ ¹æ®è¿”å›å€¼åˆ¤æ–­æ˜¯å¦è¦ç»§ç»­æ›´æ–°</li>
<li>æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ <code>componentWillUpdate</code></li>
<li>æ‰§è¡ŒçœŸæ­£çš„æ›´æ–°ï¼Œ<code>render</code></li>
<li>æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ <code>componentDidUpdate</code></li>
</ul>

<p>Reference:</p>

<ul>
<li><a href="https://medium.com/@wereHamster/beware-react-setstate-is-asynchronous-ce87ef1a9cf3#.jhdhncws3">https://medium.com/@wereHamster/beware-react-setstate-is-asynchronous-ce87ef1a9cf3#.jhdhncws3</a></li>
<li><a href="https://www.bennadel.com/blog/2893-setstate-state-mutation-operation-may-be-synchronous-in-reactjs.htm">https://www.bennadel.com/blog/2893-setstate-state-mutation-operation-may-be-synchronous-in-reactjs.htm</a></li>
<li><a href="https://juejin.im/post/5c71050ef265da2db27938b5">ã€React æ·±å…¥ã€‘setState çš„æ‰§è¡Œæœºåˆ¶</a></li>
</ul>

<h3 id="passing-a-function-to-setstate">Passing a function to setState</h3>

<p>æˆ‘ä»¬å·²ç»æåˆ°è¿‡, setState å…¶å®æ˜¯å¼‚æ­¥çš„. å› ä¸ºå‡ºäºæ€§èƒ½ä¼˜åŒ–è€ƒè™‘, React ä¼šå°†å¤šæ¬¡ setState åšä¸€æ¬¡æ‰¹å¤„ç†. äºæ˜¯ setState å¹¶ä¸ä¼šåœ¨è¢«è°ƒç”¨ä¹‹åç«‹å³æ”¹å˜æˆ‘ä»¬çš„ state. è¿™å°±æ„å‘³ç€ä½ å¹¶ä¸èƒ½ä¾èµ–äºåœ¨è°ƒç”¨ setState æ–¹æ³•ä¹‹å state , å› ä¸ºæ­¤æ—¶ä½ å¹¶ä¸èƒ½ç¡®è®¤è¯¥ state æ›´æ–°ä¸å¦.</p>

<p>å½“ç„¶é’ˆå¯¹è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¹Ÿæœ‰è§£å†³åŠæ³•:ç”¨å‰ä¸€ä¸ª state(previous state) ä½œä¸ºéœ€è¦ä¼ å…¥å‡½æ•°çš„å‚æ•°,å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ setState ï¼Œè¿™æ ·åšèƒ½ä¿è¯ä½ ä¼ å…¥çš„å‡½æ•°éœ€è¦å–åˆ°çš„ state ä¸€å®šä¼šæ˜¯è¢«ä¼ å…¥çš„ setState æ‰§è¡Œä¹‹åçš„ state ã€‚</p>

<h4 id="é—®é¢˜">é—®é¢˜ï¼š</h4>

<pre><code class="language-Jsx">// assuming this.state.count === 0
this.setState({count: this.state.count + 1});
this.setState({count: this.state.count + 1});
this.setState({count: this.state.count + 1});
// this.state.count === 1, not 3
</code></pre>

<h4 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•ï¼š</h4>

<pre><code class="language-Jsx">this.setState((prevState, props) =&gt; ({
  count: prevState.count + props.increment
}));
</code></pre>

<h4 id="and-more">and Moreï¼š</h4>

<pre><code class="language-Jsx">// Passing object
this.setState({ expanded: !this.state.expanded });

// Passing function
this.setState(prevState =&gt; ({ expanded: !prevState.expanded }));
</code></pre>

<p>Referenceï¼š</p>

<ul>
<li><a href="https://medium.com/javascript-scene/setstate-gate-abc10a9b2d82">setState() Gate</a></li>
<li><a href="http://stackoverflow.com/questions/43428456/do-i-need-to-use-setstatefunction-overload-in-this-case/43440790#43440790">Do I need to use setState(function) overload in this case?</a></li>
<li><a href="https://medium.freecodecamp.com/functional-setstate-is-the-future-of-react-374f30401b6b">Functional setState is the future of React</a></li>
</ul>

<h3 id="redux-reselect">Redux Reselect</h3>

<p>åœ¨ React-Redux çš„ connect(mapState)ä¸­ä½¿ç”¨ Reselect, è¿™èƒ½é¿å…é¢‘ç¹çš„é‡æ–°æ¸²æŸ“çš„å‘ç”Ÿã€‚</p>

<p>Reslect ä¼šè®°å½•ä¸‹ä¸Šä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„ç»“æœå¹¶ä¸”å½“å†æ¬¡ä»¥ç›¸åŒæ–¹å¼è°ƒç”¨æ—¶è¿”å›ç›¸åŒçš„ç»“æœ(è€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªä¸€æ¨¡ä¸€æ ·çš„æ–°ç»“æœ). åªæœ‰å½“ä¼ å…¥çš„å‚æ•°ä¸åŒæ—¶ï¼Œæ‰ä¼šäº§ç”Ÿæ–°çš„ç»“æœã€‚</p>

<p>Reference:</p>

<ul>
<li><a href="https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f#.cz2ypc2ob">React</a></li>
<li><a href="http://redux.js.org/docs/recipes/ComputingDerivedData.html">Computing Derived Data: Docs</a></li>
</ul>

<h3 id="dependency-injection">Dependency Injection</h3>

<p>åœ¨ React ä¸­ï¼Œæƒ³åšä¾èµ–æ³¨å…¥(Dependency Injection)å…¶å®ç›¸å½“ç®€å•ï¼Œå…·ä½“æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>

<ul>
<li>HOCâ€”â€”é«˜é˜¶ç»„ä»¶(high-order component)</li>
<li>Context ä¼ é€’ï¼ˆåœ¨æœ€æ–°çš„ React å®˜æ–¹æ–‡æ¡£ä¸­ï¼ŒContext å·²ç»ä¸å¤ªè¢«å®˜æ–¹æ¨èä½¿ç”¨äº†ï¼š<a href="https://reactjs.org/docs/context.html#why-not-to-use-context">Why Not To Use Context</a></li>
</ul>

<p>Reference:</p>

<ul>
<li><a href="https://www.youtube.com/watch?v=IKD2-MAkXyQ">What is Dependency Injection?</a></li>
<li><a href="https://www.youtube.com/watch?v=jXhdOTw1q5Q">The Basics of Dependency Injection</a></li>
<li><a href="http://krasimirtsonev.com/blog/article/Dependency-injection-in-JavaScript">Dependency injection in JavaScript</a></li>
<li><a href="https://github.com/krasimir/react-in-patterns/tree/master/patterns/dependency-injection">DI In React</a></li>
</ul>

<h3 id="react-lazy">React Lazy</h3>

<p><code>React Lazy</code> æ˜¯ 16.6 ä¹‹åæ·»åŠ çš„åŠŸèƒ½ã€‚éœ€è¦é…åˆ <code>react.Suspense</code> ä½¿ç”¨ã€‚</p>

<p>ç±»ä¼¼ç¤¾åŒºå®ç°çš„ <a href="https://github.com/jamiebuilds/react-loadable">react-loadable</a> ï¼Œåœ¨ä¹‹å‰æˆ‘ä»¬æ˜¯é€šè¿‡ webpack çš„ <code>require.ensure</code> æˆ–è€…è‡ªå·±å°è£… <code>import()</code> æ¥å®ç°ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ <code>code splitting</code>ã€‚</p>

<h3 id="react-hooks">React hooks</h3>

<p><code>Hooks</code> æ˜¯ 16.7 ä¹‹åæ–°æ·»åŠ çš„åŠŸèƒ½ã€‚</p>

<p>React Team æ”¶äº† <a href="https://github.com/acdlite/recompose">recompose</a> æ¼”åŒ–æˆäº† <code>Hooks</code></p>

<p>ç®€å•ç†è§£<code>Hooks</code> æ˜¯ä¸€ç§å‡½æ•°ï¼Œè¯¥å‡½æ•°å…è®¸ä½ â€œå‹¾ä½ï¼ˆhook intoï¼‰â€React çŠ¶æ€å’Œæ¥è‡ªå‡½æ•°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸåŠŸèƒ½ã€‚</p>

<p>Hook åœ¨ç±»å†…éƒ¨ä¸èµ·ä½œç”¨ï¼Œå®ƒä»¬å…è®¸ä½ æ— éœ€ç±»å°±ä½¿ç”¨ Reactã€‚</p>

<blockquote>
<p>å¯ä»¥é€šè¿‡å–å·§çš„æ–¹å¼å®ç°ï¼šhook é‡Œé¢è¿”å› class componentï¼Œä¼ å…¥ç›¸åº”çš„ props</p>
</blockquote>

<h4 id="hooks-ç§ç±»">hooks ç§ç±»</h4>

<p>React å†…ç½®äº†ä¸€äº› hookï¼Œå¦‚ <code>useState</code> å½“ç„¶ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå®šä¹‰çš„ <code>Hooks</code> ä»¥åœ¨ä¸åŒçš„ç»„ä»¶å½“ä¸­å¤ç”¨çŠ¶æ€ã€‚</p>

<p>æ ¹æ® React å®˜æ–¹ç»™å‡ºçš„æ–‡æ¡£ï¼ŒHooks ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p>

<ul>
<li>State Hooksï¼ˆå¯ä»¥å®ç° local state æˆ–è€… global state</li>
<li>Effect Hooksï¼ˆå¯ä»¥å®ç° class å½“ä¸­çš„ä¸€äº› lifecycle</li>
<li>è‡ªå®šä¹‰ Hooksï¼ˆä¸»è¦ç”¨æ¥å¤ç”¨ç»„ä»¶é€»è¾‘å’ŒçŠ¶æ€</li>
</ul>

<h4 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h4>

<p>å®˜æ–¹å®šä¹‰äº†ä¸€äº› rules of hooksï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨ hooks æ—¶å€™éœ€è¦æ³¨æ„çš„å†…å®¹ï¼š</p>

<ul>
<li>åªèƒ½åœ¨é¡¶å±‚è°ƒç”¨ Hookï¼Œä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hookã€‚</li>
<li>ä»…ä» React åŠŸèƒ½ç»„ä»¶è°ƒç”¨ Hookã€‚ä¸è¦ä»å¸¸è§„ JavaScript å‡½æ•°è°ƒç”¨ Hookã€‚ï¼ˆè¿˜æœ‰å¦ä¸€ä¸ªæœ‰æ•ˆçš„åœ°æ–¹æ¥è°ƒç”¨ Hookï¼Œå³ä½ çš„è‡ªå®šä¹‰ Hookã€‚ï¼‰</li>
</ul>

<p>å®˜æ–¹è¿˜æä¾›äº† <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks">linter plugin</a> æ¥æ£€æŸ¥å¹¶è‡ªåŠ¨æ‰§è¡Œè¿™äº›è§„åˆ™</p>

<h4 id="å¼•å…¥çš„èƒŒæ™¯">å¼•å…¥çš„èƒŒæ™¯</h4>

<p>ä¸ºä»€ä¹ˆè¦å¼•å…¥ <code>Hooks</code> ï¼Œå¤§æ¦‚æœ‰ä»¥ä¸‹åŸå› ï¼ˆæ‘˜è‡ª<a href="https://reactjs.org/docs/hooks-intro.html#motivation">å®˜æ–¹æ–‡æ¡£</a></p>

<ul>
<li>éš¾ä»¥åœ¨ç»„ä»¶ä¹‹é—´é‡ç”¨æœ‰çŠ¶æ€é€»è¾‘ï¼ˆç»„ä»¶æ ‘ ğŸŒ² è¿‡äºè‡ƒè‚¿</li>
<li>å¤æ‚çš„ç»„ä»¶å˜å¾—éš¾ä»¥ç†è§£ï¼ˆçŠ¶æ€é€»è¾‘å’ŒæŠ½è±¡è¿‡å¤š</li>
<li>ç±»è®©äººå’Œæœºå™¨æ„Ÿåˆ°å›°æƒ‘ï¼ˆä¸‡æ¶çš„ this å’Œæ•°æ®æµçš„ç†è§£</li>
<li>é€æ­¥é‡‡ç”¨ç­–ç•¥ï¼ˆæ„Ÿè§‰æ˜¯æä¾›æ–°çš„ ideaï¼Œå¹¶ä¸æ˜¯æŠ›å¼ƒ class component çš„å†™æ³•</li>
</ul>

<blockquote>
<p>æˆªæ­¢è‡³ï¼ˆ2018 å¹´ 10 æœˆ 29 æ—¥ 15:21:47ï¼‰ï¼Œç¤¾åŒºå·²ç»å‡ºç°äº†å¾ˆå¤šå…³äº hooks çš„åº“å’Œ ideaï¼Œå°è±¡è¾ƒæ·±çš„æ˜¯è¿™ä¸ª <a href="https://github.com/streamich/react-use">react-use</a> ï¼Œçœ‹äº†ä¸€ä¸‹æºç å¯¹ hooks çš„ç†è§£æ›´å¤šäº†ä¸€å±‚</p>
</blockquote>

<p>Reference:</p>

<ul>
<li><a href="https://reactjs.org/docs/hooks-intro.html">offical intro hooks</a></li>
<li><a href="https://github.com/streamich/react-use">github react-use</a></li>
<li><a href="https://github.com/rehooks">github rehooks</a></li>
<li><a href="https://github.com/rehooks/awesome-react-hooks">github awesome react hoos list</a></li>
<li><a href="https://github.com/f/react-hooks-todo-app">github react hooks todo app</a></li>
<li><a href="https://github.com/semlinker/reactjs-interview-questions">List of top 301 ReactJS Interview Questions &amp; Answers</a></li>
</ul>

<h3 id="react-fiber-æµ…æ">React Fiberï¼ˆæµ…æï¼‰</h3>

<p>React å›¢é˜Ÿé‡å†™äº†æ ¸å¿ƒç®—æ³• <a href="https://reactjs.org/docs/reconciliation.html">Reconciliation</a>ï¼Œä¼˜åŒ–åœ¨åŠ¨ç”»ã€æ‰‹åŠ¿ç­‰åº”ç”¨ä¸­çš„æ•ˆæœï¼Œé€šå¸¸å°†ä¹‹å‰çš„ <code>reconciler</code> ç§°ä¸º <code>stack reconciler</code>ï¼Œé‡å†™åçš„ç§°ä¸º <code>fiber reconciler</code>ï¼Œç®€ç§°ä¸º <code>Fiber</code></p>

<blockquote>
<p>å…³äº <code>React Fiber Reconciliation</code> å¯ä»¥çœ‹<a href="https://www.youtube.com/watch?v=ZCuYPiUIONs">Lin Clark - A Cartoon Intro to Fiber - React Conf 2017</a>ï¼Œæˆ–è€…çœ‹è¿™ç¯‡æ–‡ç« <a href="https://juejin.im/post/5ab7b3a2f265da2378403e57">ã€ŠReact Fiberã€‹</a> ç”¨æ–‡å­—ç‰ˆè§£é‡Šäº† Link Clark çš„è§†é¢‘</p>
</blockquote>

<p>Fiber ä¹Ÿç§°åç¨‹ï¼Œè¿™ä¸ªæ¦‚å¿µåœ¨å¾ˆå¤šè¯­è¨€å½“ä¸­éƒ½å­˜åœ¨ï¼Œæ¯”å¦‚ go çš„ <code>Coroutine</code>ï¼Œè¿˜æœ‰å‰ç«¯å¼€å‘è€…æ¯”è¾ƒç†Ÿæ‚‰çš„ ES6 æ–°å¢çš„ <code>Generator</code>ï¼Œåç¨‹å‡½æ•°å®ƒåªæ˜¯ä¸€ç§æ§åˆ¶æµç¨‹çš„è®©å‡ºæœºåˆ¶ï¼Œå¯ä»¥ä¸­æ–­å’Œæ¢å¤å‡½æ•°</p>

<p>React Fiber çš„æ€æƒ³å’Œåç¨‹çš„æ¦‚å¿µæ˜¯å¥‘åˆçš„: ğŸ”´React æ¸²æŸ“çš„è¿‡ç¨‹å¯ä»¥è¢«ä¸­æ–­ï¼Œå¯ä»¥å°†æ§åˆ¶æƒäº¤å›æµè§ˆå™¨ï¼Œè®©ä½ç»™é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæµè§ˆå™¨ç©ºé—²åå†æ¢å¤æ¸²æŸ“</p>

<blockquote>
<p>ä¹Ÿå¯ä»¥ç†è§£ React å®ç°äº†<a href="https://github.com/facebook/react/blob/master/packages/scheduler/src/Scheduler.js#L48-L60">Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</a>æ¥è°ƒåº¦ä¼˜å…ˆçº§ä¸åŒçš„ä»»åŠ¡ï¼ˆä»»åŠ¡åŒ…å« JS çš„æ‰§è¡Œã€é¡µé¢çš„æ¸²æŸ“ã€ui äº‹ä»¶çš„å“åº”ç­‰ç­‰ï¼‰</p>
</blockquote>

<p>å…·ä½“æ›´è¯¦ç»†çš„ä»‹ç»å¯ä»¥æŸ¥çœ‹æˆ‘è½¬è½½çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="/blog/2019-10-23-è½¬è½½è¿™å¯èƒ½æ˜¯æœ€é€šä¿—çš„-react-fiberæ—¶é—´åˆ†ç‰‡-æ‰“å¼€æ–¹å¼/">è½¬è½½ï¼šè¿™å¯èƒ½æ˜¯æœ€é€šä¿—çš„-react-fiber æ—¶é—´åˆ†ç‰‡-æ‰“å¼€æ–¹å¼</a></p>

<p>Reference:</p>

<ul>
<li><a href="https://reactjs.org/docs/reconciliation.html">Reconciliation</a></li>
<li><a href="https://www.youtube.com/watch?v=ZCuYPiUIONs">Lin Clark - A Cartoon Intro to Fiber - React Conf 2017</a></li>
<li><a href="https://juejin.im/post/5ab7b3a2f265da2378403e57">ã€ŠReact Fiberã€‹</a></li>
<li><a href="https://github.com/facebook/react/blob/master/packages/scheduler/src/Scheduler.js#L48-L60">Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰</a></li>
<li><a href="https://juejin.im/post/5dadc6045188255a270a0f85">è¿™å¯èƒ½æ˜¯æœ€é€šä¿—çš„ React Fiber(æ—¶é—´åˆ†ç‰‡) æ‰“å¼€æ–¹å¼</a></li>
</ul>

    </section>
    <nav class="no-print post-nav">
        
        <a class="prev-post" href="https://hasaki.xyz/blog/2017-09-12-%E5%89%8D%E7%AB%AF%E6%80%A7%E8%83%BD%E6%A3%80%E6%B5%8B%E5%92%8C%E9%94%99%E8%AF%AF%E6%8D%95%E6%8D%89/">
            <img class="icon-text" src="/img/prev.svg"/>å‰ç«¯æ€§èƒ½æ£€æµ‹å’Œé”™è¯¯æ•æ‰</a>
        
        
        <a class="next-post" href="https://hasaki.xyz/blog/2017-12-13-react-native-art/">React Native ART ä»‹ç»ä¸å®è·µ<img class="icon-text" src="/img/next.svg"/>
        </a>
        
    </nav>
</article>



<div id="disqus_thread" class="no-print"></div>
<script type="text/javascript">
  'use strict'
  ;(function() {
    if ('localhost' != window.location.hostname) {
      var a = document.querySelector('#disqus_thread')
      new IntersectionObserver(
        function(b) {
          b.forEach(function(d) {
            if (0 < d.intersectionRatio && !a.classList.contains('active')) {
              var e = document.createElement('script')
              ;(e.type = 'text/javascript'), (e.async = !0)
              ;(e.src =
                '//' + 'hasaki-xyz' + '.disqus.com/embed.js'),
                (
                  document.getElementsByTagName('head')[0] ||
                  document.getElementsByTagName('body')[0]
                ).appendChild(e),
                a.classList.add('active')
            }
          })
        },
        { rootMargin: '0px', threshold: 1 },
      ).observe(a)
    }
  })()
</script>

<script type="text/javascript">
  window.customElements.define(
    'back-to-top',
    class BackToTop extends HTMLElement {
      constructor() {
        super()
      }

      connectedCallback() {
        const shadowRoot = this.attachShadow({ mode: 'open' })

        shadowRoot.innerHTML = `
          <style>
            :host {
              box-sizing: border-box;
              position: fixed;
              width: 55px;
              height: 55px;
              bottom: 8%;
              right: 3%;
              border-radius: 5px;
              display: flex;
              justify-content: center;
              align-items: center;
              flex-direction: column;
              cursor: pointer;
              will-change: transform;
              transform: translate3d(0, 500px, 0);
              transition: transform 1s ease;
              background: #ff8181;
              border: 1px solid #ff8181;
              color: #fff;
            }
            :host(.show) {
              transform: translate3d(0, 0, 0);
            }
            :host::after,
            :host::before {
              content: '';
              display: block;
              box-sizing: border-box;
              position: relative;
            }
            :host::before {
              width: 8px;
              height: 8px;
              border-top: 2px solid;
              border-left: 2px solid;
              transform: rotate(45deg);
              top: 4px;
            }
            :host::after {
              width: 2px;
              height: 16px;
              top: -4px;
              background: currentColor;
            }
        `

        shadowRoot.host.addEventListener('click', e => {
          window.scrollTo({
            top: 0,
            left: 0,
            behavior: 'smooth',
          })
        })

        const scrollHeight = document.documentElement.scrollHeight

        window.addEventListener('scroll', e => {
          if (document.documentElement.scrollTop > scrollHeight / 4) {
            shadowRoot.host.classList.add('show')
          } else {
            shadowRoot.host.classList.remove('show')
          }
        })
      }
    },
  )
</script>
<back-to-top></back-to-top>


<style rel="catalog">
  #catalog {
    position: fixed;
    min-width: 12vw;
    left: 3vw;
    top: 8vh;
    overflow: auto;
    height: calc(100% - 16vh);
    background:
      linear-gradient(
        white 30%,
        rgba(255, 255, 255, 0)
      ),
      linear-gradient(rgba(255, 255, 255, 0), white 70%) 0 100%,
       
        radial-gradient(
          50% 0,
          farthest-side,
          rgba(0, 0, 0, 0.2),
          rgba(0, 0, 0, 0)
        ),
      radial-gradient(
          50% 100%,
          farthest-side,
          rgba(0, 0, 0, 0.2),
          rgba(0, 0, 0, 0)
        )
        0 100%;
    background:
      linear-gradient(
        white 30%,
        rgba(255, 255, 255, 0)
      ),
      linear-gradient(rgba(255, 255, 255, 0), white 70%) 0 100%,
       
        radial-gradient(
          farthest-side at 50% 0,
          rgba(0, 0, 0, 0.2),
          rgba(0, 0, 0, 0)
        ),
      radial-gradient(
          farthest-side at 50% 100%,
          rgba(0, 0, 0, 0.2),
          rgba(0, 0, 0, 0)
        )
        0 100%;
    background-repeat: no-repeat;
    background-color: white;
    background-size: 100% 40px, 100% 40px, 100% 14px, 100% 14px;

     
    background-attachment: local, local, scroll, scroll;
  }
  @media (max-width: 1280px) {
    #catalog {
      display: none;
    }
  }

  #catalog::-webkit-scrollbar {
    display: none;
  }

  .cl-wrapper {
    position: relative;
  }

  .cl-wrapper ul,
  .cl-wrapper li {
    margin: 0;
    -moz-padding-start: 12px;
    -webkit-padding-start: 12px;
    list-style: none;
  }

  .cl-wrapper li > .cl-link.cl-link-active {
    color: #ff8181;
    transition: 0.5s;
  }

  .cl-wrapper li > .cl-transform.cl-link-active {
    transform: translate(3px);
  }

  .cl-wrapper .cl-link {
    cursor: pointer;
    color: rgba(52, 73, 94, 0.5);
    font-size: 13px;
    transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
  }

  .cl-wrapper .cl-marker {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
  }

  .cl-wrapper .cl-marker path {
    transition: all 0.3s ease;
  }
</style>
<main id="catalog"></main>
<script rel="catalog">
  void (function() {
    if (
      window.innerWidth < 1024 ||
      /iPhone|iPad|iPod|Android/i.test(navigator.userAgent)
    ) {
      return
    }

    const Catalog = (function() {
      return function(opts) {
        let defaultOpts = {
          linkClass: 'cl-link', 
          linkActiveClass: 'cl-link-active', 
          datasetName: 'data-cata-target', 
          selector: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'], 
          scrollWrapper: null, 
          activeHook: null, 
          topMargin: 0,
          bottomMargin: 0,
          cool: true, 
        }

        const Opt = Object.assign({}, defaultOpts, opts)

        const $content = document.getElementById(Opt.contentEl) 
        const $scroll_wrap = window 
        const $catalog = document.getElementById(Opt.catalogEl) 

        let allCatalogs = $content.querySelectorAll(Opt.selector.join())
        let tree = getCatalogsTree(allCatalogs)

        try {
          $catalog.innerHTML = `<div class='cl-wrapper'>${generateHtmlTree(
            tree,
            { id: -1 },
          )}<svg class="cl-marker" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
            <path stroke="#ff8181" stroke-width="3" fill="transparent" stroke-dasharray="0, 0, 0, 1000" stroke-linecap="round" stroke-linejoin="round" transform="translate(-0.5, -0.5)" />
            </svg></div>`
        } catch (e) {
          console.error('error in progress-catalog', e)
        }

        const tocPath = $catalog.querySelector('.cl-marker path')
        let tocItems, pathLength 

        
        window.addEventListener('resize', drawPath)
        $catalog.addEventListener('click', clickHandler)
        Opt.cool && $scroll_wrap.addEventListener('scroll', coolScrollHandler)
        Opt.cool || $scroll_wrap.addEventListener('scroll', simpleScrollHandler)

        setTimeout(drawPath) 

        

        function drawPath() {
          tocItems = [...$catalog.querySelectorAll('li')]
          tocItems = tocItems.map(function(liDom) {
            const anchor = liDom.querySelector(`.${Opt.linkClass}`)
            const target = document.getElementById(
              anchor.getAttribute('data-cata-target'),
            )

            return {
              listItem: liDom,
              anchor: anchor,
              target: target,
            }
          })
          tocItems = tocItems.filter(item => !!item.target)

          const path = []
          let pathIndent

          tocItems &&
            tocItems.forEach(function(item, idx) {
              const { offsetLeft, offsetTop, offsetHeight } = item.anchor,
                x = Opt.cool ? offsetLeft - 5 : offsetLeft,
                y = offsetTop,
                height = offsetHeight

              if (idx === 0) {
                path.push('M', x, y, 'L', x, y + height)
                item.pathStart = 0
              } else {
                if (pathIndent !== x) path.push('L', pathIndent, y) 
                path.push('L', x, y)
                tocPath.setAttribute('d', path.join(' '))
                item.pathStart = tocPath.getTotalLength() || 0
                path.push('L', x, y + height)
              }
              pathIndent = x
              tocPath.setAttribute('d', path.join(' '))
              item.pathEnd = tocPath.getTotalLength()
            })
          pathLength = tocPath.getTotalLength()
          coolScrollHandler()
        }

        

        function coolScrollHandler() {
          const wrapHeight = document.documentElement.offsetHeight
          let pathStart = pathLength,
            pathEnd = 0,
            visibleItems = 0
          tocItems.forEach(function(liItem) {
            const { bottom, top } = liItem.target.getBoundingClientRect(),
              firstChild = liItem.listItem.firstChild
            if (bottom > Opt.topMargin && top < wrapHeight - Opt.bottomMargin) {
              firstChild.classList.remove(Opt.linkActiveClass)
              Opt.cool && firstChild.classList.remove('cl-transform')
            } else {
              pathStart = Math.min(liItem.pathStart, pathStart)
              pathEnd = Math.max(liItem.pathEnd, pathEnd)
              visibleItems += 1
              firstChild.classList.add(Opt.linkActiveClass)
              Opt.cool && firstChild.classList.add('cl-transform')
            }
          })
          if (visibleItems > 0 && pathStart < pathEnd && Opt.cool) {
            tocPath.setAttribute('stroke-dashoffset', '1')
            tocPath.setAttribute(
              'stroke-dasharray',
              `1, ${pathStart}, ${pathEnd - pathStart}, ${pathLength}`,
            )
            tocPath.setAttribute('opacity', '1')
          } else {
            tocPath.setAttribute('opacity', '0')
          }
        }

        

        function simpleScrollHandler(el) {
          let scrollToEl = null
          for (let i = allCatalogs.length - 1; i >= 0; i--) {
            if (allCatalogs[i].offsetTop <= $scroll_wrap.scrollTop) {
              scrollToEl = allCatalogs[i]
              break
            }
          }
          if (scrollToEl) setActiveItem(scrollToEl.id)
          else setActiveItem(null) 
        }

        

        function clickHandler({ target }) {
          const datasetId = target.getAttribute(Opt.datasetName)
          target.classList.contains(Opt.linkClass) &&
            document
              .getElementById(datasetId)
              .scrollIntoView({ behavior: 'smooth', block: 'start' })
        }

        

        function getCatalogsTree(catalogs) {
          let title,
            tagName,
            tree = [],
            treeItem = {},
            parentItem = { id: -1 },
            lastTreeItem = null,
            id

          for (let i = 0; i < catalogs.length; i++) {
            title = catalogs[i].innerText || catalogs[i].textContent
            tagName = catalogs[i].tagName
            id = 'heading-' + i
            catalogs[i].id = id
            treeItem = {
              name: title,
              tagName: tagName,
              id: id,
              level: +getLevel(tagName),
              parent: parentItem,
            }
            if (lastTreeItem) {
              if (getLevel(treeItem.tagName) > getLevel(lastTreeItem.tagName)) {
                treeItem.parent = lastTreeItem
              } else {
                treeItem.parent = findParent(treeItem, lastTreeItem)
              }
            }
            lastTreeItem = treeItem
            tree.push(treeItem)
          }
          return tree
        }

        

        function findParent(currTreeItem, lastTreeItem) {
          let lastTreeParent = lastTreeItem.parent
          while (
            lastTreeParent &&
            getLevel(currTreeItem.tagName) <= getLevel(lastTreeParent.tagName)
          ) {
            lastTreeParent = lastTreeParent.parent
          }
          return lastTreeParent || { id: -1 }
        }

        

        function getLevel(tagName) {
          return tagName ? tagName.slice(1) : 0
        }

        

        function generateHtmlTree(tree, _parent) {
          let ul,
            hasChild = false
          if (tree) {
            ul = `<ul>`
            for (let i = 0; i < tree.length; i++) {
              if (isEqual(tree[i].parent, _parent)) {
                hasChild = true
                ul += `<li><div class='${Opt.linkClass} cl-level-${tree[i].level}' ${Opt.datasetName}='${tree[i].id}'>${tree[i].name}</div>`
                ul += generateHtmlTree(tree, tree[i])
                ul += '</li>'
              }
            }
            ul += `</ul>`
          }
          return hasChild ? ul : ''
        }

        /**
         * åˆ¤æ–­æ˜¯å¦æ˜¯ç›¸åŒèŠ‚ç‚¹
         */
        function isEqual(node, node2) {
          return (
            node &&
            node2 &&
            typeof node === 'object' &&
            typeof node2 === 'object' &&
            node.id === node2.id
          )
        }

        /**
         *  è®¾ç½®é€‰ä¸­çš„é¡¹
         */
        function setActiveItem(id) {
          let catas = [...$catalog.querySelectorAll(`[${Opt.datasetName}]`)]

          catas.forEach(T => {
            if (T.getAttribute(Opt.datasetName) === id) {
              typeof Opt.activeHook === 'function' &&
                !T.classList.contains(Opt.linkActiveClass) &&
                Opt.activeHook.call(this, T) // æ‰§è¡Œactiveé’©å­
              T.classList.add(Opt.linkActiveClass)
            } else {
              T.classList.remove(Opt.linkActiveClass)
            }
          })
        }
      }
    })()
    window.addEventListener('DOMContentLoaded', function() {
      new Catalog({
        contentEl: 'markdown',
        catalogEl: 'catalog',
      })
    })
  })()
</script>

			<hr class="sep" />
		</main>
		<footer class="container no-print">
			<div class="u-footer">
				
<a href="mailto:iamnomand@gmail.com"><img class="icon-social" src="/img/email.svg" alt="Email Me!"/></a>


<a href="https://github.com/v-tom/"><img class="icon-social" src="/img/github.svg" alt="Github"/></a>


<a href="https://twitter.com/iamnomand"><img class="icon-social" src="/img/twitter.svg" alt="Twitter"/></a>

<a href="https://hasaki.xyz/index.xml" target="_blank"><img class="icon-social" src="/img/feed.svg" alt="Feed"></a>

				<p>
					
					
					Early 2016 ~ 2020 &copy; TOM's Zone
					
					
				</p>
				
				<a href="#brand">
					<img class="icon-text" src="/img/toup.svg" alt="To Up"/>
					<span>Back to Up</span>
				</a>
				
			</div>
		</footer>
		
		<script>hljs.initHighlightingOnLoad();</script>
		
	</body>
</html>


<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=UA-108259988-2"
></script>
<script>
  window.dataLayer = window.dataLayer || []
  function gtag() {
    dataLayer.push(arguments)
  }
  gtag('js', new Date())

  gtag('config', 'UA-108259988-2')
</script>

